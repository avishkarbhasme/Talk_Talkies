<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie Search</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Manufacturing+Consent&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        background-image: url("./images/bgmovie1.jpg");
        background-repeat: no-repeat;
        background-position: center center;
        background-size: cover;
        background-attachment: fixed;
        font-family: Poppins, sans-serif;
        color: #444;
        overflow-x: hidden;
      }

      body::-webkit-scrollbar {
        display: none;
      }

      .nav {
        margin: 5px;
        background-color: #222;
        border-radius: 30px;
        color: white;
        padding: 10px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: fixed;
        top: 0;
        left: 0;
        width: calc(100% - 10px);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        z-index: 1000;
      }

      .navbar {
        height: 11vh;
      }

      .symbol {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: "Manufacturing Consent", system-ui;
        font-weight: 400;
        font-style: normal;
        font-size: clamp(24px, 5vw, 40px);
        text-shadow: 0 0 3px #090909;
      }

      .symbol img {
        width: clamp(30px, 8vw, 60px);
        height: clamp(30px, 8vw, 60px);
      }

      .symname {
        color: rgb(227, 44, 44);
      }

      .containerr ul {
        list-style: none;
        display: flex;
        gap: 20px;
        margin: 0;
        padding: 0;
      }

      .item {
        height: auto;
        padding: 5px 10px;
        border: 1px solid transparent;
        transition: border-color 0.3s ease-in-out;
        cursor: pointer;
      }

      .item:hover {
        border-top-color: rgb(240, 255, 37);
        border-right-color: black;
        border-bottom-color: rgb(48, 241, 225);
        border-left-color: black;
      }

      .item a {
        text-decoration: none;
        color: white;
        padding: 8px;
        display: block;
        font-size: clamp(14px, 2vw, 16px);
      }

      .login {
        display: flex;
        align-items: center;
      }

      .login img {
        width: clamp(20px, 4vw, 24px);
        height: clamp(20px, 4vw, 24px);
        margin-right: 5px;
      }

      .neonText:hover {
        color: #fff;
        text-shadow: 0 0 7px #fff, 0 0 10px #fff, 0 0 21px #fff,
          0 0 42px rgb(239, 12, 186), 0 0 82px rgb(239, 12, 186),
          0 0 92px rgb(239, 12, 186), 0 0 102px rgb(239, 12, 186),
          0 0 120px rgb(239, 12, 186);
      }

      .neon:hover {
        color: #fff;
        text-shadow: 0 0 7px #fff, 0 0 10px #fff, 0 0 21px #fff,
          0 0 42px rgb(227, 44, 44), 0 0 82px rgb(227, 44, 44),
          0 0 92px rgb(227, 44, 44), 0 0 102px rgb(227, 44, 44),
          0 0 120px rgb(227, 44, 44);
      }

      .navmovie {
        border-top-color: rgb(240, 255, 37);
        border-right-color: black;
        border-bottom-color: rgb(48, 241, 225);
        border-left-color: black;
      }

      .dropdown {
        position: relative;
      }

      .dropdown ul {
        display: none;
        position: absolute;
        background-color: #333;
        list-style: none;
        padding: 10px;
        margin-top: 5px;
      }

      .dropdown ul li {
        padding: 5px 0;
      }

      .dropdown ul li a {
        color: white;
      }

      .dropdown ul.show {
        display: block;
      }

      .hamburger {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        z-index: 1100;
        position: relative;
      }

      .hamburger svg {
        width: clamp(24px, 6vw, 30px);
        height: clamp(24px, 6vw, 30px);
        fill: white;
      }

      .movfli {
        margin: clamp(20px, 5vw, 100px);
        margin-top: clamp(80px, 15vw, 120px);
      }

      .abovesec {
        border-bottom: 3px solid rgb(206, 234, 25);
        margin-bottom: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
      }

      .mo {
        width: clamp(30px, 6vw, 50px);
        height: clamp(30px, 6vw, 50px);
      }

      .movname {
        font-size: clamp(24px, 6vw, 45px);
        font-weight: 800;
        color: skyblue;
      }

      .search-container {
        background: #222;
        padding: clamp(10px, 3vw, 20px);
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .filters {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .filters input,
      .filters select {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: clamp(14px, 2vw, 16px);
        width: 100%;
        max-width: 300px;
      }

      .movie-grid {
        padding-top: 20px;
        display: grid;
        grid-template-columns: repeat(
          auto-fill,
          minmax(clamp(200px, 30vw, 300px), 1fr)
        );
        gap: clamp(10px, 2vw, 20px);
      }

      .movie-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        cursor: pointer;
      }

      .movie-card .poster {
        height: clamp(150px, 25vw, 200px);
        background: #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(18px, 4vw, 24px);
        font-weight: 600;
        color: #201f1f;
      }

      .movie-card .summary {
        padding: clamp(10px, 2vw, 15px);
        overflow: hidden;
      }

      .movie-card .description {
        font-size: clamp(12px, 2vw, 14px);
        color: #555;
        max-height: 4.5em; /* Fallback: 3 lines at ~1.5em per line */
        line-height: 1.5em;
        overflow: hidden;
        text-overflow: ellipsis;
        margin: 5px 0;
        display: -webkit-box;
        line-clamp: 3; /* Truncates to 3 lines in supported browsers */
        -webkit-box-orient: vertical;
      }

      .close {
        position: absolute;
        top: 15px;
        right: 15px;
        font-size: 1.5rem;
        cursor: pointer;
        color: #fff; /* White for visibility on dark modal background */
        background: rgb(227, 44, 44); /* Neon red background for contrast */
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s ease;
        z-index: 1300; /* Ensure above modal content */
      }

      .close:hover {
        background: rgb(239, 12, 186); /* Neon pink on hover for consistency */
      }

      .movie-card h3 {
        margin: 0 0 10px;
        font-size: clamp(18px, 4vw, 25px);
        color: #090909;
      }

      .movie-card p {
        margin: 5px 0;
        color: #555;
      }

      .rating .stars {
        color: #ffd700;
        font-size: 1em;
        display: inline-block;
        margin-left: 5px;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        align-items: center;
        justify-content: center;
        z-index: 1200;
      }

      .modal-content {
        background: white;
        padding: clamp(15px, 3vw, 20px);
        border-radius: 8px;
        max-width: clamp(300px, 90vw, 700px);
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .modal-poster {
        width: 100%;
        height: clamp(100px, 40vw, 300px);
        background: #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(1.5rem, 5vw, 3rem);
        font-weight: 800;
        color: #111111;
        margin-bottom: 15px;
      }

      .modal-content h2 {
        margin-top: 0;
        margin-bottom: 10px;
      }

      .modal-content p {
        margin: 10px 0;
      }

      .close {
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 1.5rem;
        cursor: pointer;
        color: #000;
        font-weight: bold;
      }

      .summary > p {
        color: #090909;
      }

      @media (max-width: 768px) {
        .navbar {
          padding: 10px;
        }

        .containerr {
          display: none;
          width: 100%;
          position: absolute;
          top: 100%;
          left: 0;
          background-color: #222;
          border-radius: 0 0 30px 30px;
          z-index: 1000;
        }

        .containerr.active {
          display: block;
        }

        .containerr ul {
          flex-direction: column;
          gap: 10px;
          padding: 10px;
        }

        .item {
          text-align: center;
        }

        .hamburger {
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .movfli {
          margin: clamp(20px, 5vw, 50px);
          margin-top: clamp(80px, 15vw, 100px);
        }

        .filters {
          flex-direction: column;
          align-items: center;
        }

        .movie-grid {
          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
      }

      @media (max-width: 480px) {
        .nav {
          padding: 5px 10px;
        }

        .movie-grid {
          grid-template-columns: 1fr;
        }

        .movie-card .poster {
          height: 150px;
        }

        .modal-content {
          padding: 10px;
        }

        .modal-poster {
          height: 100px;
        }
      }
    </style>
  </head>
  <body>
    <nav class="nav navbar">
      <div class="symbol">
        <a class="logo" href="/index.html">
          <img class="img" alt="Logo" src="/images/favicon.png" />
        </a>
        <a class="symname neon" href="/index.html">TalkTalkies</a>
      </div>
      <button class="hamburger" aria-label="Toggle menu">
        <svg width="30" height="30" viewBox="0 0 30 30" fill="white">
          <path d="M5 6h20v4H5zm0 7h20v4H5zm0 7h20v4H5z" />
        </svg>
      </button>
      <div class="containerr">
        <ul>
          <li class="item neonText">
            <a class="nav-link" href="/index.html">Home</a>
          </li>
          <li class="item navmovie neonText">
            <a class="nav-link" href="/subpages/moviepage/index.html">Movies</a>
          </li>
          <li class="item dropdown neonText">
            <a id="dropdown-link" href="/subpages/genrepage/index.html"
              >Genre</a
            >
          </li>
          <li class="item neonText">
            <a
              class="nav-link"
              href="/subpages/communitypage/com/frontend/index.html"
              >Community</a
            >
          </li>
          <li class="item login neonText">
            <a class="nav-link" href="/auth/index.html"
              ><img src="/images/login.png" alt="login"
            /></a>
            <a class="nav-link" href="/auth/index.html">Login</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="movfli">
      <div class="abovesec">
        <img
          class="mo"
          width="50px"
          height="50px"
          src="/subpages/moviepage/images/moimg.png"
        />
        <div class="movname">Movie Finder</div>
      </div>
      <div class="search-container">
        <div class="filters">
          <input type="text" id="searchInput" placeholder="Search movies..." />
          <select id="genreFilter">
            <option value="">All Genres</option>
          </select>
          <input type="number" id="yearFilter" placeholder="Enter Year" />
          <input
            type="number"
            id="ratingFilter"
            placeholder="Enter Rating"
            step="0.1"
            min="0"
            max="10"
          />
        </div>
      </div>
      <div class="movie-grid" id="movieGrid"></div>
      <div class="modal" id="movieModal">
        <div class="modal-content">
          <button class="close" id="closeModal" aria-label="Close modal">
            ✖
          </button>
          <div class="modal-poster" id="modalPoster">Poster</div>
          <h2 id="modalTitle"></h2>
          <p><strong>IMDb ID:</strong> <span id="modalImdbId"></span></p>
          <p><strong>Genres:</strong> <span id="modalGenres"></span></p>
          <p>
            <strong>Release Year:</strong> <span id="modalReleaseYear"></span>
          </p>
          <p><strong>Rating:</strong> <span id="modalRating"></span></p>
          <p><strong>Director:</strong> <span id="modalDirector"></span></p>
          <p><strong>Cast:</strong> <span id="modalCast"></span></p>
          <p><strong>Runtime:</strong> <span id="modalRuntime"></span></p>
          <p><strong>Tagline:</strong> <span id="modalTagline"></span></p>
          <p><strong>Keywords:</strong> <span id="modalKeywords"></span></p>
          <p>
            <strong>Production Companies:</strong>
            <span id="modalProduction"></span>
          </p>
          <p><strong>Overview:</strong> <span id="modalOverview"></span></p>
          <p>
            <strong>Homepage:</strong>
            <a href="#" id="modalHomepage" target="_blank"></a>
          </p>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const hamburger = document.querySelector(".hamburger");
        const navContainer = document.querySelector(".containerr");
        if (hamburger && navContainer) {
          hamburger.addEventListener("click", () => {
            navContainer.classList.toggle("active");
          });
        }

        const searchInput = document.getElementById("searchInput");
        const genreFilter = document.getElementById("genreFilter");
        const yearFilter = document.getElementById("yearFilter");
        const ratingFilter = document.getElementById("ratingFilter");
        const movieGrid = document.getElementById("movieGrid");
        const movieModal = document.getElementById("movieModal");
        const closeModal = document.getElementById("closeModal");

        let allMovies = [];

        async function loadMovies() {
          try {
            const [response1, response2] = await Promise.all([
              fetch("/movies2.json"),
              fetch("/auth/data/movies.json"),
            ]);

            if (!response1.ok || !response2.ok) {
              throw new Error("Failed to fetch one or both JSON files");
            }

            const movies1 = await response1.json();
            const movies2 = await response2.json();
            allMovies = [...movies1, ...movies2];

            populateFilters();
            displayMovies(allMovies);
          } catch (error) {
            console.error("Error loading movies:", error);
            movieGrid.innerHTML =
              "<p>Error loading movies. Please try again later.</p>";
          }
        }

        function populateFilters() {
          const genres = [
            ...new Set(allMovies.flatMap((movie) => movie.genres.split("|"))),
          ];
          genres.forEach((genre) => {
            const option = document.createElement("option");
            option.value = genre;
            option.textContent = genre;
            genreFilter.appendChild(option);
          });
        }

        function getDynamicStars(rating) {
          const maxStars = 5;
          const starRating = (rating || 0) / 2;
          const fullStars = Math.floor(starRating);
          const hasHalfStar = starRating % 1 >= 0.25 && starRating % 1 < 0.75;
          let starHtml = "";

          for (let i = 0; i < maxStars; i++) {
            if (i < fullStars) {
              starHtml += '<span class="stars">★</span>';
            } else if (i === fullStars && hasHalfStar) {
              starHtml +=
                '<span class="stars" style="position: relative;">★<span style="position: absolute; top: 0; left: 0; width: 50%; overflow: hidden; color: #ffd700;">★</span></span>';
            } else {
              starHtml += '<span class="stars">☆</span>';
            }
          }
          return starHtml;
        }
        function displayMovies(movies) {
          movieGrid.innerHTML = "";
          movies.forEach((movie) => {
            const movieCard = document.createElement("div");
            movieCard.className = "movie-card";
            const stars = getDynamicStars(movie.vote_average);
            const description =
              movie.overview && typeof movie.overview === "string"
                ? movie.overview.substring(0, 100) +
                  (movie.overview.length > 100 ? "..." : "")
                : "No description available";
            movieCard.innerHTML = `
            <div class="poster">${movie.original_title || "Untitled"}</div>
            <div class="summary">
                <h3>${movie.original_title || "Untitled"}</h3>
                <p>Genre: ${movie.genres || "N/A"}</p>
                <p>Year: ${movie.release_year || "N/A"}</p>
                <p>Rating: <span class="rating">${
                  movie.vote_average || "N/A"
                } <span class="stars-container">${stars}</span></span></p>
                <p class="description">${description}</p>
            </div>
        `;
            movieCard.addEventListener("click", () => showModal(movie));
            movieGrid.appendChild(movieCard);
          });
        }

        function filterMovies() {
          const searchTerm = searchInput.value.toLowerCase();
          const selectedGenre = genreFilter.value;
          const selectedYear = yearFilter.value;
          const selectedRating = ratingFilter.value;

          const filteredMovies = allMovies.filter((movie) => {
            const title =
              typeof movie.original_title === "string"
                ? movie.original_title.toLowerCase()
                : "";
            const matchesSearch = title.includes(searchTerm);
            const matchesGenre =
              !selectedGenre ||
              (movie.genres && movie.genres.split("|").includes(selectedGenre));
            const matchesYear =
              !selectedYear ||
              (movie.release_year &&
                movie.release_year.toString() === selectedYear);
            const matchesRating =
              !selectedRating ||
              (movie.vote_average &&
                movie.vote_average >= parseFloat(selectedRating));

            return (
              matchesSearch && matchesGenre && matchesYear && matchesRating
            );
          });

          displayMovies(filteredMovies);
        }

        function showModal(movie) {
          document.getElementById("modalPoster").textContent =
            movie.original_title || "Poster";
          document.getElementById("modalTitle").textContent =
            movie.original_title || "N/A";
          document.getElementById("modalImdbId").textContent =
            movie.imdb_id || "N/A";
          document.getElementById("modalGenres").textContent =
            movie.genres || "N/A";
          document.getElementById("modalReleaseYear").textContent =
            movie.release_year || "N/A";
          document.getElementById("modalRating").textContent =
            movie.vote_average || "N/A";
          document.getElementById("modalDirector").textContent =
            movie.director || "N/A";
          document.getElementById("modalCast").textContent =
            movie.cast || "N/A";
          document.getElementById("modalRuntime").textContent =
            movie.runtime || "N/A";
          document.getElementById("modalTagline").textContent =
            movie.tagline || "N/A";
          document.getElementById("modalKeywords").textContent =
            movie.keywords || "N/A";
          document.getElementById("modalProduction").textContent =
            movie.production_companies || "N/A";
          document.getElementById("modalOverview").textContent =
            movie.overview || "N/A";
          const homepage = document.getElementById("modalHomepage");
          homepage.href = movie.homepage || "#";
          homepage.textContent = movie.homepage || "N/A";
          document.getElementById("movieModal").style.display = "flex";
        }

        closeModal.addEventListener("click", () => {
          document.getElementById("movieModal").style.display = "none";
        });

        window.addEventListener("click", (event) => {
          if (event.target === document.getElementById("movieModal")) {
            document.getElementById("movieModal").style.display = "none";
          }
        });

        searchInput.addEventListener("input", filterMovies);
        genreFilter.addEventListener("change", filterMovies);
        yearFilter.addEventListener("input", filterMovies);
        ratingFilter.addEventListener("input", filterMovies);

        loadMovies();
      });
    </script>
  </body>
</html>
